<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sea_you.dao.BeachDAO">

  <select id="selectByPlace"
          parameterType="string"
          resultType="com.sea_you.dto.BeachDTO">
    SELECT
      bc_no,
      bc_name,
      bc_location,
      bc_office,
      bc_length,
      bc_width,
      bc_area,
      bc_image,
      es_id
    FROM beach
    WHERE bc_location LIKE '%' || #{value} || '%'
    ORDER BY bc_name
  </select>
<update id="updateDao">
    UPDATE beach
    SET bc_image = #{bc_image}
    WHERE bc_no = #{bc_no}
</update>
<select id="getTop5Beaches" resultType="com.sea_you.dto.BeachDTO">
    <![CDATA[
    SELECT * FROM (
        SELECT 
            b.bc_no, 
            b.bc_name, 
            b.bc_image, 
            b.bc_location,
            COUNT(bm.bc_no) AS bookmark_count
        FROM beach b
        LEFT JOIN bookmark bm ON b.bc_no = bm.bc_no
        GROUP BY b.bc_no, b.bc_name, b.bc_image, b.bc_location
        ORDER BY bookmark_count DESC, b.bc_name ASC
    ) WHERE ROWNUM <= 5
    ]]>
  </select>

</mapper>
